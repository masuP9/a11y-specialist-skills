[English](./automated-checks.md)

# 自動チェック (Playwright a11y tree)

Playwrightのアクセシビリティツリーから機械的に判定できる項目のみを扱います。判定は「Fail/Pass/NT/NA」を明示し、証跡はa11y treeスナップショットまたはDOM断片を保存します。

## 判定ルールの共通方針
- 取得元: `page.accessibility.snapshot()` / DOM属性
- 証跡: 要素のロール、名前、関連属性、XPath/CSSセレクタ
- Fail条件: ルールに一致しない要素が1件でもある

## 構造・セマンティクス
| 基準 | 自動チェック | 証跡 | Fail条件 |
|---|---|---|---|
| 1.3.1 | 見出し/ランドマーク/リスト/テーブルが適切なロールで表現されている | a11y tree断片 | 意味的に必要な要素が全てプレーンテキスト扱いになる |
| 1.3.2 | a11y treeの順序がDOM順と一致している | a11y tree + DOM順 | 読み上げ順がDOM順と矛盾する構造がある |
| 2.4.1 | 主要ブロックを飛ばす手段の存在（スキップリンク / mainランドマーク / メインコンテンツ内の見出し） | a11y tree（リンク名、ランドマーク、見出し構造） | スキップリンク・mainランドマーク・適切な見出しのいずれもない |
| 2.4.2 | ページタイトルが空でない | `document.title` | タイトル未設定/空文字 |
| 2.4.6 | 見出し/ラベルにアクセシブルネームがある | a11y treeのname | 見出し/ラベルが無名 |

## 代替テキスト
| 基準 | 自動チェック | 証跡 | Fail条件 |
|---|---|---|---|
| 1.1.1 | 画像のアクセシブルネーム有無（`alt`/`aria-label`等） | a11y tree | 情報性のある画像が無名 |
| 3.3.2 | フォーム入力にラベルまたは説明が紐付いている | a11y tree + DOM | 入力要素が無名/説明不足 |

## ARIA
| 基準 | 自動チェック | 証跡 | Fail条件 |
|---|---|---|---|
| 4.1.2 | ロール/名前/値が取得可能 | a11y tree | インタラクティブ要素が無名/ロール不明 |
| 4.1.3 | ステータスメッセージが適切なロールで露出 | a11y tree | 状態変化がrole="status"等で表出しない |
| 2.5.3 | 視覚ラベルの文字列がアクセシブルネームに含まれる | DOMテキスト + a11y name | ラベル文字列がnameに含まれない |

## 言語
| 基準 | 自動チェック | 証跡 | Fail条件 |
|---|---|---|---|
| 3.1.1 | `<html lang>`が有効な言語タグ | DOM属性 | lang未設定/無効 |

## リンク/ボタン
| 基準 | 自動チェック | 証跡 | Fail条件 |
|---|---|---|---|
| 2.4.4 | リンクのアクセシブルネームが空でない | a11y tree | 空リンク/無名リンク |
| 3.2.1 | フォーカス時に意図しないコンテキスト変更がない（DOM差分で検知） | DOM差分ログ | フォーカスのみでページ遷移や大幅な更新 |
| 3.2.2 | 入力変更時に自動送信/遷移がない（DOM差分で検知） | DOM差分ログ | 入力操作のみで送信/遷移 |

## 一貫性
| 基準 | 自動チェック | 証跡 | Fail条件 |
|---|---|---|---|
| 3.2.3 | 同一サイト内で主要ナビゲーションの構造が一致 | a11y tree比較 | ナビゲーション構造が大きく異なる |
| 3.2.4 | 同一機能のコンポーネントが同一ロール/名前で表現 | a11y tree比較 | 同一機能の名前/ロールが不一致 |
| 3.2.6 | ヘルプ手段（FAQ/連絡先等）が一貫して提供 | a11y tree比較 | あるページだけヘルプが欠落 |
